var SimpleSpreadsheet=function(e){var t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(n,s,function(t){return e[t]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t);class n extends Error{constructor(e){super(e)}}const s=Object.freeze({EOF:Symbol("EOF"),WHITESPACE:Symbol("WHITESPACE"),PLUS:Symbol("PLUS"),MINUS:Symbol("MINUS"),STAR:Symbol("STAR"),SLASH:Symbol("SLASH"),LPAREN:Symbol("LPAREN"),RPAREN:Symbol("RPAREN"),COLON:Symbol("COLON"),EQUALS:Symbol("EQUALS"),COMMA:Symbol("COMMA"),NUMBER:Symbol("NUMBER"),STRING:Symbol("STRING"),IDENTIFIER:Symbol("IDENTIFIER")});class i{constructor(e={$:s.EOF,"\\s+":s.WHITESPACE,"\\+":s.PLUS,"-":s.MINUS,"\\*":s.STAR,"\\/":s.SLASH,"\\(":s.LPAREN,"\\)":s.RPAREN,"=":s.EQUALS,":":s.COLON,",":s.COMMA,"\\d+(?:\\.\\d+)?":s.NUMBER,'\\"(?:[^"\\\\]|\\\\.)*\\"':s.STRING,"[a-zA-Z]\\w+":s.IDENTIFIER}){this.rules=e}begin(e){return this.remaining=e,this}next(){const e=this.peek();return this.remaining=this.remaining.slice(e.value.length),e}peek(){for(let e in this.rules){const t=this.remaining.match(new RegExp("^"+e));if(null!==t)return{type:this.rules[e],value:t[0]}}throw new n(`Unknown token '${this.remaining}'`)}rest(){const e=this.remaining;return this.remaining="",e}}class o{}class a extends o{constructor(e){super(),this.value=e}toString(){return this.value.constructor===String?`"${this.value}"`:`${this.value}`}}class l extends o{constructor(e,t){super(),this.col=e,this.row=t}toString(){return`Reference(${this.col}${this.row})`}}class u extends o{constructor(e,t,r){super(),this.left=e,this.op=t,this.right=r}toString(){return`BinaryOp(${this.left} ${this.op} ${this.right})`}}class c extends o{constructor(e,t){super(),this.op=e,this.value=t}toString(){return`UnaryOp(${this.op} ${this.value})`}}class h extends o{constructor(e,t){super(),this.functionName=e,this.args=t}toString(){return`FunctionCall(${this.functionName}, ${this.args.join(", ")})`}}class p extends o{constructor(e,t){super(),this.from=e,this.to=t}toString(){return`Range(${this.from}, ${this.to})`}}class f{constructor(e){this.tokens=e}parse(e){return this.tokens.begin(e),this.parseCell()}parseCell(){if(this.tokens.remaining.startsWith("=")){this._expectAny(s.EQUALS);const e=this.parseExpression();return this._require(s.EOF),e}{const e=this.tokens.rest();return""==e?new a(null):isNaN(e)?new a(e):new a(parseFloat(e))}}parseExpression(){return this.parseTerm()}parseTerm(){let e,t=this.parseFactor();for(;null!==(e=this._expectAny(s.PLUS,s.MINUS));)t=new u(t,e.value,this.parseFactor());return t}parseFactor(){let e,t=this.parseUnary();for(;null!==(e=this._expectAny(s.STAR,s.SLASH));)t=new u(t,e.value,this.parseUnary());return t}parseUnary(){let e=this._expectAny(s.PLUS,s.MINUS);return null!==e?new c(e.value,this.parseUnary()):this.parseValue()}parseValue(){if(this._expectAny(s.LPAREN)){const e=this.parseExpression();return this._require(s.RPAREN),e}const e=this._expectAny(s.NUMBER);if(null!==e)return new a(parseFloat(e.value));const t=this._expectAny(s.STRING);if(null!==t)return new a(t.value.substring(1,t.value.length-1));const r=this._require(s.IDENTIFIER);if(null!==r&&this._expectAny(s.COLON)){const e=this._require(s.IDENTIFIER),t=this._parseReference(r.value),i=this._parseReference(e.value);if(t.col!==i.col&&t.row!==i.row)throw new n(`Range start and end not in same column or row: ${r.value}:${e.value}`);return new p(t,i)}if(this._expectAny(s.LPAREN)){let e=r.value;do{const t=this.parseArguments();e=new h(e,t)}while(this._expectAny(s.LPAREN));return e}return this._parseReference(r.value)}_parseReference(e){const t=e.match(/^([A-Za-z]+)(\d+)$/);if(null===t)throw new n(`Invalid format of cell reference: ${e}`);return new l(t[1],parseInt(t[2]))}parseArguments(){const e=[];for(;!this._expectAny(s.RPAREN);)0!=e.length&&this._require(s.COMMA),e.push(this.parseExpression());return e}_expectAny(...e){const t=this._next();return e.includes(t.type)?(this.tokens.next(),t):null}_require(e){const t=this._expectAny(e);if(null===t)throw new n(`Expected ${e}, got ${this.tokens.peek().type} instead`);return t}_next(){let e=this.tokens.peek();for(;e.type===s.WHITESPACE;)this.tokens.next(),e=this.tokens.peek();return e}}class S extends Error{constructor(e){super(e)}}class w{constructor(e={},t={}){this.cells=e,this.functions=t}getEntry(e,t){return void 0===this.cells[`${e}${t}`]?null:this.cells[`${e}${t}`]}setEntry(e,t,r){this.cells[`${e}${t}`]=r}getFunction(e){if(void 0===this.functions[e])throw new Error(`Unknown function: ${e}`);return this.functions[e]}}class y{evaluateCell(e,t){switch(e.constructor){case a:return e.value;case l:const r=t.getEntry(e.col,e.row)||new a(null);return this.evaluateCell(r,t);case u:return this.evaluateBinary(e.left,e.op,e.right,t);case h:return this.evaluateFunction(e.functionName,e.args,t);case p:throw new S("Range references are allowed only as arguments of functions");default:throw new S(`Unknown expression type: ${typeof e}`)}}evaluateExpression(e,t){switch(e.constructor){case p:return this.evaluateRange(e.from,e.to,t);default:return this.evaluateCell(e,t)}}evaluateBinary(e,t,r,n){const s=this.evaluateCell(e,n),i=this.evaluateCell(r,n);switch(t){case"+":return s+i;case"-":return s-i;case"*":return s*i;case"/":return s/i;default:throw new S(`Unknown binary operator: ${t.type}`)}}evaluateFunction(e,t,r){const n=t.map(e=>this.evaluateExpression(e,r)),s=r.getFunction(e);try{return s(...n)}catch(t){throw new S(`Error in function ${e}: ${t}`)}}evaluateRange(e,t,r){return this._cellsInRange(e,t).map(e=>this.evaluateCell(e,r))}_cellsInRange(e,t){if(e.col===t.col)return this._range(e.row,t.row).map(t=>new l(e.col,t));if(e.row===t.row)return this._range(e.col.charCodeAt(0),t.col.charCodeAt(0)).map(t=>new l(String.fromCharCode(t),e.row));throw new S(`Range must be in same row or column. From: ${e}, To: ${t}`)}_range(e,t){return e<=t?Array.from({length:t-e+1},(t,r)=>r+e):Array.from({length:e-t+1},(t,r)=>e-r)}}r.d(t,"Spreadsheet",function(){return m});class m{constructor(e={}){this._parser=new f(new i),this._evaluator=new y,this.cells=e,this.expressions=this._mapValues(e,e=>this._parser.parse(e)),this._environment=new w(this.expressions,{SUM:(...e)=>e.flat().reduce((e,t)=>e+t,0),AVERAGE:(...e)=>e.flat().reduce((e,t)=>e+t,0)/e.flat().length})}text(e){return void 0===this.cells[e]?"":this.cells[e]}value(e){return this._evaluator.evaluateCell(this._expression(e),this._environment)}_expression(e){return this._parser.parse(this.text(e))}_mapValues(e,t){const r={};for(let n in e)r[n]=t(e[n]);return r}}}]);
//# sourceMappingURL=simple-spreadsheet.min.js.map